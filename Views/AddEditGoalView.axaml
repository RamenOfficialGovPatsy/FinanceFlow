<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="using:FinanceFlow.ViewModels"
             xmlns:models="using:FinanceFlow.Models"
             mc:Ignorable="d" d:DesignWidth="500" d:DesignHeight="900"
             x:Class="FinanceFlow.Views.AddEditGoalView"
             x:DataType="vm:AddEditGoalViewModel"
             FontFamily="{StaticResource ManropeFont}">

    <UserControl.Styles>
        <Style Selector="CalendarDatePicker">
            <Setter Property="Background" Value="{StaticResource AppCardBackground}"/>
            <Setter Property="Foreground" Value="{StaticResource AppText}"/>
            <Setter Property="BorderBrush" Value="{StaticResource AppBorderBrush}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="CornerRadius" Value="6"/>
            <Setter Property="Padding" Value="12, 8"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
            <Setter Property="HorizontalContentAlignment" Value="Left"/>
        </Style>
        <Style Selector="CalendarDatePicker /template/ Button#PART_Button">
             <Setter Property="Foreground" Value="{StaticResource AppTextSecondary}"/>
        </Style>
    </UserControl.Styles>

    <Grid RowDefinitions="Auto, *, Auto" Margin="24,24,24,20">
        
        <Grid Grid.Row="0" Margin="0,0,0,24">
            <TextBlock Text="{Binding WindowTitle}" FontSize="24" FontWeight="Bold" Foreground="{StaticResource AppText}"/>
        </Grid>

        <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" Padding="0,0,10,0">
            <StackPanel Spacing="20">
                
                <StackPanel Spacing="8">
                    <TextBlock Classes="Label" Text="ÐÐ°Ð·Ð²Ð°Ð½Ð¸Ðµ Ñ†ÐµÐ»Ð¸"/>
                    <TextBox Text="{Binding Title, Mode=TwoWay}" Watermark="Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ Ð½Ð°Ð·Ð²Ð°Ð½Ð¸Ðµ..." Classes="form-input"/>
                </StackPanel>

                <StackPanel Spacing="8">
                    <TextBlock Classes="Label" Text="ÐšÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ñ"/>
                    <ComboBox ItemsSource="{Binding Categories}"
                              SelectedItem="{Binding SelectedCategory, Mode=TwoWay}"
                              HorizontalAlignment="Stretch" 
                              HorizontalContentAlignment="Left"
                              PlaceholderText="Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸ÑŽ">
                        <ComboBox.ItemTemplate>
                            <DataTemplate DataType="models:GoalCategory">
                                <StackPanel Orientation="Horizontal" Spacing="12" VerticalAlignment="Center">
                                    <Border Width="24" Height="24" CornerRadius="6" Background="#2D3748">
                                        <TextBlock Text="{Binding Icon}" FontSize="14" HorizontalAlignment="Center" VerticalAlignment="Center"
                                                   FontFamily="Segoe UI Emoji, Apple Color Emoji, Noto Color Emoji, System"/>
                                    </Border>
                                    <TextBlock Text="{Binding Name}" VerticalAlignment="Center"/>
                                </StackPanel>
                            </DataTemplate>
                        </ComboBox.ItemTemplate>
                    </ComboBox>
                </StackPanel>

                <StackPanel Spacing="8">
                    <TextBlock Classes="Label" Text="ÐŸÑ€Ð¸Ð¾Ñ€Ð¸Ñ‚ÐµÑ‚"/>
                    <ComboBox ItemsSource="{Binding Priorities}"
                              SelectedItem="{Binding SelectedPriority, Mode=TwoWay}"
                              HorizontalAlignment="Stretch" 
                              HorizontalContentAlignment="Left"
                              PlaceholderText="Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ð¿Ñ€Ð¸Ð¾Ñ€Ð¸Ñ‚ÐµÑ‚">
                        <ComboBox.ItemTemplate>
                            <DataTemplate DataType="vm:PriorityItem">
                                <StackPanel Orientation="Horizontal" Spacing="10" VerticalAlignment="Center">
                                    <Ellipse Width="12" Height="12" Fill="{Binding Color}"/>
                                    <TextBlock Text="{Binding Name}" VerticalAlignment="Center"/>
                                </StackPanel>
                            </DataTemplate>
                        </ComboBox.ItemTemplate>
                    </ComboBox>
                </StackPanel>

                <StackPanel Spacing="8">
                    <TextBlock Classes="Label" Text="Ð¦ÐµÐ»ÐµÐ²Ð°Ñ ÑÑƒÐ¼Ð¼Ð°"/>
                    <Grid ColumnDefinitions="*, Auto">
                        <NumericUpDown Value="{Binding TargetAmount, Mode=TwoWay}" FormatString="N0" Minimum="0" ParsingNumberStyle="Integer" HorizontalAlignment="Stretch"/>
                        <TextBlock Grid.Column="1" Text="â‚½" FontSize="16" VerticalAlignment="Center" Margin="12,0,0,0" Foreground="{StaticResource AppTextSecondary}"/>
                    </Grid>
                </StackPanel>

                <StackPanel Spacing="8">
                    <TextBlock Classes="Label" Text="Ð¢ÐµÐºÑƒÑ‰Ð°Ñ ÑÑƒÐ¼Ð¼Ð°"/>
                    <Grid ColumnDefinitions="*, Auto">
                        <NumericUpDown Value="{Binding CurrentAmount, Mode=TwoWay}" FormatString="N0" Minimum="0" ParsingNumberStyle="Integer" HorizontalAlignment="Stretch"/>
                        <TextBlock Grid.Column="1" Text="â‚½" FontSize="16" VerticalAlignment="Center" Margin="12,0,0,0" Foreground="{StaticResource AppTextSecondary}"/>
                    </Grid>
                </StackPanel>

                <StackPanel Spacing="8">
                    <TextBlock Classes="Label" Text="Ð”Ð°Ñ‚Ð° Ð½Ð°Ñ‡Ð°Ð»Ð°"/>
                    <Grid ColumnDefinitions="Auto, 16, *">
                        <TextBlock Grid.Column="0" Text="ðŸ“…" FontSize="28" VerticalAlignment="Center" FontFamily="Segoe UI Emoji, Apple Color Emoji, Noto Color Emoji, System"/>
                        <CalendarDatePicker Grid.Column="2" SelectedDate="{Binding StartDate, Mode=TwoWay}" 
                                            SelectedDateFormat="Custom" CustomDateFormatString="dd.MM.yyyy" 
                                            Watermark="Ð”Ð”.ÐœÐœ.Ð“Ð“Ð“Ð“" HorizontalAlignment="Stretch" HorizontalContentAlignment="Left"/>
                    </Grid>
                </StackPanel>

                <StackPanel Spacing="8">
                    <TextBlock Classes="Label" Text="Ð”Ð°Ñ‚Ð° Ð¾ÐºÐ¾Ð½Ñ‡Ð°Ð½Ð¸Ñ"/>
                    <Grid ColumnDefinitions="Auto, 16, *">
                        <TextBlock Grid.Column="0" Text="ðŸ“…" FontSize="28" VerticalAlignment="Center" FontFamily="Segoe UI Emoji, Apple Color Emoji, Noto Color Emoji, System"/>
                        <CalendarDatePicker Grid.Column="2" SelectedDate="{Binding EndDate, Mode=TwoWay}"
                                            SelectedDateFormat="Custom" CustomDateFormatString="dd.MM.yyyy" 
                                            Watermark="Ð”Ð”.ÐœÐœ.Ð“Ð“Ð“Ð“" HorizontalAlignment="Stretch" HorizontalContentAlignment="Left"/>
                    </Grid>
                </StackPanel>

                <StackPanel Spacing="8">
                    <TextBlock Classes="Label" Text="ÐžÐ¿Ð¸ÑÐ°Ð½Ð¸Ðµ"/>
                    <TextBox Text="{Binding Description, Mode=TwoWay}" Watermark="Ð”Ð¾Ð±Ð°Ð²ÑŒÑ‚Ðµ Ð¾Ð¿Ð¸ÑÐ°Ð½Ð¸Ðµ..." Height="120" AcceptsReturn="True" TextWrapping="Wrap" VerticalContentAlignment="Top"/>
                </StackPanel>

                <StackPanel Spacing="8">
                    <TextBlock Classes="Label" Text="Ð˜Ð·Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ðµ Ñ†ÐµÐ»Ð¸"/>
                    <StackPanel Orientation="Horizontal" Spacing="12">
                        <Button Height="40" Background="{StaticResource AppCardBackground}" BorderThickness="0" CornerRadius="6" Padding="20, 0"
                                Click="LoadImageButton_Click"> 
                            <StackPanel Orientation="Horizontal" Spacing="8" VerticalAlignment="Center">
                                <TextBlock Text="ðŸ“Ž" Foreground="#8B5CF6" FontSize="18" VerticalAlignment="Center" FontFamily="Segoe UI Emoji, Apple Color Emoji, Noto Color Emoji, System"/>
                                <TextBlock Text="Ð—Ð°Ð³Ñ€ÑƒÐ·Ð¸Ñ‚ÑŒ Ð¸Ð·Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ðµ" Foreground="{StaticResource AppTextSecondary}" FontWeight="Normal" VerticalAlignment="Center"/>
                            </StackPanel>
                        </Button>
                        <Button Height="40" Background="{StaticResource AppCardBackground}" BorderThickness="0" CornerRadius="6" Padding="20, 0"
                                Command="{Binding DeleteImageCommand}">
                             <StackPanel Orientation="Horizontal" Spacing="8" VerticalAlignment="Center">
                                <TextBlock Text="ðŸ—‘ï¸" FontSize="16" VerticalAlignment="Center" FontFamily="Segoe UI Emoji, Apple Color Emoji, Noto Color Emoji, System"/>
                                <TextBlock Text="Ð£Ð´Ð°Ð»Ð¸Ñ‚ÑŒ Ð¸Ð·Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ðµ" Foreground="#EF4444" FontWeight="Normal" VerticalAlignment="Center"/>
                            </StackPanel>
                        </Button>
                    </StackPanel>
                </StackPanel>

                <Border Height="200" CornerRadius="8" BorderBrush="{StaticResource AppBorderBrush}" BorderThickness="1" Background="{StaticResource AppCardBackground}" ClipToBounds="True">
                    <Panel>
                        <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center" Spacing="12"
                                    IsVisible="{Binding !HasImage}">
                            <TextBlock Text="ðŸ–¼ï¸" FontSize="48" HorizontalAlignment="Center" Opacity="0.3" FontFamily="Segoe UI Emoji, Apple Color Emoji, Noto Color Emoji, System"/>
                            <TextBlock Text="ÐŸÐ Ð•Ð’Ð¬Ð® Ð˜Ð—ÐžÐ‘Ð ÐÐ–Ð•ÐÐ˜Ð¯" Foreground="{StaticResource AppTextSecondary}" FontSize="14" FontWeight="Bold" LetterSpacing="1" HorizontalAlignment="Center" Opacity="0.5"/>
                        </StackPanel>
                        
                        <Image Source="{Binding GoalImage}" 
                               IsVisible="{Binding HasImage}"
                               Stretch="UniformToFill"/>
                    </Panel>
                </Border>

                <TextBlock Text="JPG, PNG, BMP, WEBP â€¢ ÐœÐ°ÐºÑ. Ñ€Ð°Ð·Ð¼ÐµÑ€ Ñ„Ð°Ð¹Ð»Ð°: 15 ÐœÐ‘"
                Foreground="{StaticResource AppTextSecondary}" 
                FontSize="12" HorizontalAlignment="Center" Margin="0, -10, 0, 20"/>

            </StackPanel>
        </ScrollViewer>

        <StackPanel Grid.Row="2" HorizontalAlignment="Right" Orientation="Horizontal" Spacing="12" Margin="0,20,0,0">
            <Button Classes="Secondary" Width="140" Height="40" Padding="0" Command="{Binding CancelCommand}">
                <StackPanel Orientation="Horizontal" Spacing="8" HorizontalAlignment="Center" VerticalAlignment="Center">
                    <Path Data="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z" Fill="#EF4444" Width="14" Height="14" Stretch="Uniform" VerticalAlignment="Center"/>
                    <TextBlock Text="ÐžÑ‚Ð¼ÐµÐ½Ð°" Foreground="{StaticResource AppTextSecondary}" VerticalAlignment="Center" FontSize="14" FontWeight="SemiBold"/>
                </StackPanel>
            </Button>
            
            <Button Classes="Primary" Width="140" Height="40" Padding="0" Command="{Binding SaveCommand}">
                <StackPanel Orientation="Horizontal" Spacing="8" HorizontalAlignment="Center" VerticalAlignment="Center">
                    <TextBlock Text="âœ…" FontSize="16" VerticalAlignment="Center" FontFamily="Segoe UI Emoji, Apple Color Emoji, Noto Color Emoji, System"/>
                    <TextBlock Text="Ð¡Ð¾Ñ…Ñ€Ð°Ð½Ð¸Ñ‚ÑŒ" Foreground="#D1D5DB" VerticalAlignment="Center" FontSize="14" FontWeight="SemiBold"/>
                </StackPanel>
            </Button>
        </StackPanel>

    </Grid>
</UserControl>