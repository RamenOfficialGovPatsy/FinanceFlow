<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:local="using:FinanceFlow"
             xmlns:vm="using:FinanceFlow.ViewModels"
             xmlns:services="using:FinanceFlow.Services.Interfaces"
             mc:Ignorable="d" d:DesignWidth="780" d:DesignHeight="1300"
             x:Class="FinanceFlow.Views.AnalyticsView"
             x:DataType="vm:AnalyticsViewModel">

    <Grid RowDefinitions="Auto, *, Auto" Margin="30, 30, 30, 20">

        <StackPanel Grid.Row="0" Orientation="Horizontal" Spacing="12" Margin="0,0,0,30">
            <Border Width="40" Height="40" CornerRadius="8" Background="{StaticResource AppCardBackground}">
                <TextBlock Text="ðŸ“Š" 
                           FontFamily="Segoe UI Emoji, Apple Color Emoji, Noto Color Emoji, System" 
                           FontSize="24" 
                           HorizontalAlignment="Center" 
                           VerticalAlignment="Center"/>
            </Border>
            <TextBlock Text="ÐÐ½Ð°Ð»Ð¸Ñ‚Ð¸ÐºÐ°" 
                       FontSize="28" 
                       FontWeight="Bold" 
                       VerticalAlignment="Center"/>
        </StackPanel>

        <!-- Ð¤Ð˜ÐšÐ¡: Ð”Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ñ‹ AllowAutoHide="False", MaxWidth Ð¸ HorizontalAlignment -->
        <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" AllowAutoHide="False" Padding="0,0,15,0">
            <StackPanel Spacing="24" MaxWidth="700" HorizontalAlignment="Center">

                <!-- Ð¤Ð˜ÐšÐ¡: Ð£Ð±Ñ€Ð°Ð½Ñ‹ Width Ð¸ HorizontalAlignment -->
                <Border Background="{StaticResource AppCardBackground}" 
                        CornerRadius="12" 
                        Padding="40">
                    <StackPanel Spacing="30">
                        <StackPanel Orientation="Horizontal" Spacing="12">
                            <TextBlock Text="ðŸ“ˆ" FontFamily="Segoe UI Emoji, Apple Color Emoji, Noto Color Emoji, System" FontSize="24"/>
                            <TextBlock Text="ÐžÐ‘Ð©ÐÐ¯ Ð¡Ð¢ÐÐ¢Ð˜Ð¡Ð¢Ð˜ÐšÐ" FontSize="20" FontWeight="SemiBold" VerticalAlignment="Center" Foreground="#F3F4F6" LetterSpacing="1"/>
                        </StackPanel>

                        <Grid ColumnDefinitions="*, 40, *" RowDefinitions="Auto, 24, Auto, 24, Auto">
                            <Grid Grid.Row="0" Grid.Column="0" ColumnDefinitions="Auto, *, Auto">
                                <StackPanel Orientation="Horizontal" Spacing="10" VerticalAlignment="Center">
                                    <Ellipse Width="8" Height="8" Fill="#311B92" VerticalAlignment="Center"/>
                                    <TextBlock Text="Ð’ÑÐµÐ³Ð¾ Ñ†ÐµÐ»ÐµÐ¹:" Foreground="{StaticResource AppTextSecondary}" FontSize="16"/>
                                </StackPanel>
                                <TextBlock Grid.Column="2" Text="{Binding TotalGoals}" FontSize="16" FontWeight="SemiBold" Foreground="{StaticResource AppTextSecondary}"/>
                            </Grid>
                            
                            <Grid Grid.Row="2" Grid.Column="0" ColumnDefinitions="Auto, *, Auto">
                                <StackPanel Orientation="Horizontal" Spacing="10" VerticalAlignment="Center">
                                    <Ellipse Width="8" Height="8" Fill="#065F46" VerticalAlignment="Center"/>
                                    <TextBlock Text="Ð’Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¾:" Foreground="{StaticResource AppTextSecondary}" FontSize="16"/>
                                </StackPanel>
                                <TextBlock Grid.Column="2" Text="{Binding CompletedGoalsText}" FontSize="16" FontWeight="SemiBold" Foreground="{StaticResource AppTextSecondary}"/>
                            </Grid>
                            
                            <Grid Grid.Row="4" Grid.Column="0" ColumnDefinitions="Auto, *, Auto">
                                <StackPanel Orientation="Horizontal" Spacing="10" VerticalAlignment="Center">
                                    <Ellipse Width="8" Height="8" Fill="#B45309" VerticalAlignment="Center"/>
                                    <TextBlock Text="Ð’ Ð¿Ñ€Ð¾Ñ†ÐµÑÑÐµ:" Foreground="{StaticResource AppTextSecondary}" FontSize="16"/>
                                </StackPanel>
                                <TextBlock Grid.Column="2" Text="{Binding InProgressGoals}" FontSize="16" FontWeight="SemiBold" Foreground="{StaticResource AppTextSecondary}"/>
                            </Grid>
                            
                            <Grid Grid.Row="0" Grid.Column="2" ColumnDefinitions="Auto, *, Auto">
                                <StackPanel Orientation="Horizontal" Spacing="10" VerticalAlignment="Center">
                                    <Ellipse Width="8" Height="8" Fill="#880E4F" VerticalAlignment="Center"/>
                                    <TextBlock Text="ÐŸÑ€Ð¾ÑÑ€Ð¾Ñ‡ÐµÐ½Ð¾:" Foreground="{StaticResource AppTextSecondary}" FontSize="16"/>
                                </StackPanel>
                                <TextBlock Grid.Column="2" Text="{Binding OverdueGoals}" FontSize="16" FontWeight="SemiBold" Foreground="{StaticResource AppTextSecondary}"/>
                            </Grid>
                            
                            <Grid Grid.Row="2" Grid.Column="2" ColumnDefinitions="Auto, *, Auto">
                                <StackPanel Orientation="Horizontal" Spacing="10" VerticalAlignment="Center">
                                    <Ellipse Width="8" Height="8" Fill="#1A237E" VerticalAlignment="Center"/>
                                    <TextBlock Text="ÐžÐ±Ñ‰Ð°Ñ ÑÑƒÐ¼Ð¼Ð°:" Foreground="{StaticResource AppTextSecondary}" FontSize="16"/>
                                </StackPanel>
                                <StackPanel Grid.Column="2" HorizontalAlignment="Right">
                                    <TextBlock Text="{Binding TotalTargetAmountText}" FontSize="16" FontWeight="SemiBold" TextAlignment="Right" Foreground="{StaticResource AppTextSecondary}"/>
                                </StackPanel>
                            </Grid>
                            
                            <Grid Grid.Row="4" Grid.Column="2" ColumnDefinitions="Auto, *, Auto">
                                <StackPanel Orientation="Horizontal" Spacing="10" VerticalAlignment="Center">
                                    <Ellipse Width="8" Height="8" Fill="#006064" VerticalAlignment="Center"/>
                                    <TextBlock Text="ÐÐ°ÐºÐ¾Ð¿Ð»ÐµÐ½Ð¾:" Foreground="{StaticResource AppTextSecondary}" FontSize="16"/>
                                </StackPanel>
                                <StackPanel Grid.Column="2" HorizontalAlignment="Right" VerticalAlignment="Center">
                                    <TextBlock Text="{Binding AccumulatedText}" FontSize="16" FontWeight="SemiBold" TextAlignment="Right" Foreground="{StaticResource AppTextSecondary}"/>
                                </StackPanel>
                            </Grid>
                        </Grid>
                    </StackPanel>
                </Border>

                <!-- Ð¤Ð˜ÐšÐ¡: Ð£Ð±Ñ€Ð°Ð½Ñ‹ Width Ð¸ HorizontalAlignment -->
                <Border Background="{StaticResource AppCardBackground}" 
                        CornerRadius="12" 
                        Padding="40">
                    
                    <StackPanel Spacing="30">
                        <StackPanel Orientation="Horizontal" Spacing="12" HorizontalAlignment="Center">
                            <TextBlock Text="ðŸ—‚ï¸" FontFamily="Segoe UI Emoji, Apple Color Emoji, Noto Color Emoji, System" FontSize="24"/>
                            <TextBlock Text="Ð ÐÐ¡ÐŸÐ Ð•Ð”Ð•Ð›Ð•ÐÐ˜Ð• ÐŸÐž ÐšÐÐ¢Ð•Ð“ÐžÐ Ð˜Ð¯Ðœ" FontSize="20" FontWeight="SemiBold" VerticalAlignment="Center" Foreground="#F3F4F6" LetterSpacing="1"/>
                        </StackPanel>

                        <local:DonutChart x:Name="CategoryChart"
                                          Values="{Binding ChartValues}"
                                          Colors="{Binding ChartColors}"
                                          Width="200" Height="200"
                                          Thickness="35"
                                          HorizontalAlignment="Center"/>
                        
                        <ItemsControl ItemsSource="{Binding CategoryLegend}">
                            <ItemsControl.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <WrapPanel HorizontalAlignment="Center" />
                                </ItemsPanelTemplate>
                            </ItemsControl.ItemsPanel>
                            
                            <ItemsControl.ItemTemplate>
                                <DataTemplate DataType="services:CategoryDistributionItem">
                                    <Border Background="#2D3748" CornerRadius="8" Padding="12" Margin="6" MinWidth="140">
                                        <Grid ColumnDefinitions="Auto, *">
                                            <Ellipse Grid.Column="0" Width="12" Height="12" 
                                                     Fill="{Binding Color}" 
                                                     VerticalAlignment="Center" Margin="0,0,12,0"/>
                                            
                                            <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                                <TextBlock Text="{Binding Percentage, StringFormat='{}{0:F1}%'}" FontSize="18" FontWeight="Bold" Foreground="#F3F4F6"/>
                                                <TextBlock Text="{Binding CategoryName}" FontSize="12" Foreground="{StaticResource AppTextSecondary}" TextTrimming="CharacterEllipsis"/>
                                            </StackPanel>
                                        </Grid>
                                    </Border>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                        
                    </StackPanel>
                </Border>

                <!-- Ð¤Ð˜ÐšÐ¡: Ð£Ð±Ñ€Ð°Ð½Ñ‹ Width Ð¸ HorizontalAlignment -->
                <Border Background="{StaticResource AppCardBackground}" 
                        CornerRadius="12" 
                        Padding="40">
                    
                    <StackPanel Spacing="24">
                        <StackPanel Orientation="Horizontal" Spacing="12">
                            <TextBlock Text="â°" FontFamily="Segoe UI Emoji, Apple Color Emoji, Noto Color Emoji, System" FontSize="24"/>
                            <TextBlock Text="Ð‘Ð›Ð˜Ð–ÐÐ™Ð¨Ð˜Ð• Ð”Ð•Ð”Ð›ÐÐ™ÐÐ«" 
                                       FontSize="20" FontWeight="SemiBold" VerticalAlignment="Center" 
                                       Foreground="#F3F4F6" LetterSpacing="1"/>
                        </StackPanel>

                        <ItemsControl ItemsSource="{Binding UpcomingDeadlines}">
                            <ItemsControl.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <StackPanel Spacing="12"/>
                                </ItemsPanelTemplate>
                            </ItemsControl.ItemsPanel>
                            
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Border Background="#1F2937" CornerRadius="8" Padding="16, 10">
                                        <Grid ColumnDefinitions="Auto, *">
                                            <Ellipse Grid.Column="0" Width="20" Height="20" 
                                                     Fill="{Binding DaysLeftColor}" 
                                                     VerticalAlignment="Center" Margin="0,0,16,0"/>
                                            
                                            <TextBlock Grid.Column="1" FontSize="16" VerticalAlignment="Center">
                                                <Run Text="{Binding EndDate, StringFormat='dd.MM.yyyy'}" Foreground="{StaticResource AppTextSecondary}"/>
                                                <Run Text=" â€¢ " Foreground="{StaticResource AppTextSecondary}"/>
                                                <Run Text="{Binding Title}" Foreground="#F3F4F6" FontWeight="Medium"/>
                                                <Run Text=" â€¢ " Foreground="{StaticResource AppTextSecondary}"/>
                                                <Run Text="{Binding DaysLeftText}" Foreground="{Binding DaysLeftColor}"/>
                                            </TextBlock>
                                        </Grid>
                                    </Border>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                        
                        <TextBlock Text="ÐÐµÑ‚ Ð°ÐºÑ‚Ð¸Ð²Ð½Ñ‹Ñ… Ñ†ÐµÐ»ÐµÐ¹ Ð¸Ð»Ð¸ Ð´ÐµÐ´Ð»Ð°Ð¹Ð½Ð¾Ð²" 
                                   IsVisible="{Binding !UpcomingDeadlines.Count}"
                                   Foreground="{StaticResource AppTextSecondary}" 
                                   HorizontalAlignment="Center" 
                                   FontStyle="Italic"/>
                    </StackPanel>
                </Border>

                <Border Height="20"/>

            </StackPanel>
        </ScrollViewer>

        <StackPanel Grid.Row="2"
                    Orientation="Horizontal" 
                    Spacing="16" 
                    HorizontalAlignment="Center"
                    Margin="0,20,0,0">
            
            <Button Classes="Primary"
                    Height="44"
                    Padding="24,0"
                    Command="{Binding GenerateReportCommand}">
                <StackPanel Orientation="Horizontal" Spacing="10" VerticalAlignment="Center">
                    <TextBlock Text="ðŸ“Š" FontFamily="Segoe UI Emoji, Apple Color Emoji, Noto Color Emoji, System" FontSize="18" VerticalAlignment="Center"/>
                    <TextBlock Text="Ð¡Ð³ÐµÐ½ÐµÑ€Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ PDF Ð¾Ñ‚Ñ‡ÐµÑ‚" 
                               Foreground="#E0E7FF" 
                               FontWeight="SemiBold" 
                               VerticalAlignment="Center"/>
                </StackPanel>
            </Button>

            <Button Height="44"
                    Background="#1F2937"
                    BorderBrush="{StaticResource AppBorderBrush}"
                    BorderThickness="1"
                    Padding="24,0"
                    Command="{Binding CloseCommand}">
                <StackPanel Orientation="Horizontal" Spacing="8" VerticalAlignment="Center">
                    <TextBlock Text="âŒ" FontFamily="Segoe UI Emoji, Apple Color Emoji, Noto Color Emoji, System" FontSize="14" Foreground="#EF4444" VerticalAlignment="Center"/>
                    <TextBlock Text="Ð—Ð°ÐºÑ€Ñ‹Ñ‚ÑŒ" 
                               Foreground="{StaticResource AppTextSecondary}" 
                               FontWeight="SemiBold" 
                               VerticalAlignment="Center"/>
                </StackPanel>
            </Button>
        </StackPanel>

    </Grid>
</UserControl>