<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="using:FinanceFlow.ViewModels"
             mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="600"
             x:Class="FinanceFlow.Views.GoalsView"
             Design.Background="{StaticResource AppBackground}">
    
    <Design.DataContext>
        <vm:MainWindowViewModel />
    </Design.DataContext>

    <Grid RowDefinitions="Auto, *">
        
        <Grid Grid.Row="0" ColumnDefinitions="Auto, *, Auto" Margin="40,20,40,10">
            
            <Button Grid.Column="0" 
                    Classes="Analytics"
                    Click="AnalyticsButton_Click">
                <StackPanel Orientation="Horizontal" Spacing="8" VerticalAlignment="Center">
                    <TextBlock Text="ðŸ“Š" FontFamily="Segoe UI Emoji, Apple Color Emoji, Noto Color Emoji, System" FontSize="16" VerticalAlignment="Center"/>
                    <TextBlock Text="ÐÐ½Ð°Ð»Ð¸Ñ‚Ð¸ÐºÐ°"
                                Foreground="{StaticResource AppPrimary}"
                                FontWeight="SemiBold"
                                VerticalAlignment="Center"/>
                </StackPanel>
            </Button>

            <Button Grid.Column="2"
                    Click="AddGoalButton_Click"
                    Classes="Primary">
                <StackPanel Orientation="Horizontal" Spacing="6" VerticalAlignment="Center">
                    <TextBlock Text="ï¼‹" FontSize="16"/>
                    <TextBlock Text="ÐÐ¾Ð²Ð°Ñ Ñ†ÐµÐ»ÑŒ" VerticalAlignment="Center"/>
                </StackPanel>
            </Button>
        </Grid>

        <ScrollViewer Grid.Row="1">
            <ItemsControl ItemsSource="{Binding Goals}" Margin="40,10,40,40">
                <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                        <StackPanel Spacing="20"/>
                    </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>

                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Border Background="{StaticResource AppCardBackground}" 
                                CornerRadius="12"
                                Padding="24">
                            
                            <Border.ContextMenu>
                                <ContextMenu>
                                    <MenuItem Header="âœï¸ Ð ÐµÐ´Ð°ÐºÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ñ†ÐµÐ»ÑŒ" 
                                              Click="EditGoalMenuItem_Click"
                                              Tag="{Binding}" />
                                    <Separator/>
                                    <MenuItem Header="ðŸ’° Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ð¿Ð¾Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ðµ" 
                                              Click="AddDepositMenuItem_Click"
                                              Tag="{Binding}"/>
                                    <Separator/>
                                    <MenuItem Header="âŒ Ð£Ð´Ð°Ð»Ð¸Ñ‚ÑŒ Ñ†ÐµÐ»ÑŒ" 
                                              Command="{Binding $parent[UserControl].DataContext.DeleteGoalCommand}"
                                              CommandParameter="{Binding}"/>
                                </ContextMenu>
                            </Border.ContextMenu>

                            <StackPanel Spacing="16">
                                
                                <StackPanel Orientation="Horizontal" Spacing="8" Opacity="0.7">
                                    <TextBlock Text="{Binding CategoryIcon}" FontSize="14" FontFamily="Segoe UI Emoji, Apple Color Emoji, Noto Color Emoji, System"/>
                                    <TextBlock Text="{Binding CategoryName}" 
                                               FontSize="12" 
                                               FontWeight="Bold" 
                                               LetterSpacing="0.05"/>
                                </StackPanel>
                                
                                <TextBlock Text="{Binding Title}" 
                                           FontSize="20" 
                                           FontWeight="Bold" /> 
                                
                                <Grid ColumnDefinitions="*, Auto">
                                    <StackPanel Grid.Column="0" Spacing="10">
                                        <TextBlock FontSize="16" FontWeight="Medium">
                                            <Run Text="{Binding CurrentAmount, StringFormat='{}{0:N0} â‚½'}"/>
                                            <Run Text="/" Foreground="{StaticResource AppTextSecondary}"/>
                                            <Run Text="{Binding TargetAmount, StringFormat='{}{0:N0} â‚½'}" Foreground="{StaticResource AppTextSecondary}"/>
                                        </TextBlock>
                                        
                                        <ProgressBar Value="{Binding ProgressPercentage}" 
                                                     Foreground="{Binding ProgressColor}"
                                                     Minimum="0" Maximum="100"/>
                                    </StackPanel>

                                    <TextBlock Grid.Column="1" 
                                               Text="{Binding ProgressPercentage, StringFormat='{}{0:F0}%'}" 
                                               FontSize="16" 
                                               FontWeight="Medium"
                                               Foreground="{StaticResource AppTextSecondary}"
                                               VerticalAlignment="Center"
                                               Margin="16,0,0,0"/>
                                </Grid>

                                <StackPanel Spacing="6" Margin="0,4,0,0">
                                    <TextBlock FontSize="12" Foreground="{StaticResource AppTextSecondary}">
                                        <Run Text="ÐžÑÑ‚Ð°Ð»Ð¾ÑÑŒ:"/>
                                        <Run Text="{Binding RemainingAmount, StringFormat='{}{0:N0} â‚½'}" FontWeight="SemiBold"/>
                                        <Run Text=" â€¢ "/>
                                        <Run Text="{Binding DaysLeftText}"
                                             Foreground="{Binding DaysLeftColor}"/>
                                    </TextBlock>
                                    
                                    <StackPanel Orientation="Horizontal" Spacing="6">
                                        <TextBlock Text="{Binding StartDate, StringFormat='ÐÐ°Ñ‡Ð°Ñ‚Ð¾: {0:dd.MM.yyyy}'}" FontSize="12" 
                                                   Foreground="{StaticResource AppTextSecondary}"/>
                                        <TextBlock Text="â€¢" FontSize="12" Foreground="{StaticResource AppTextSecondary}"/>
                                        
                                        <TextBlock Text="{Binding PriorityIcon}" FontSize="12" FontFamily="Segoe UI Emoji, Apple Color Emoji, Noto Color Emoji, System"/> 
                                        
                                        <TextBlock Text="{Binding PriorityName, StringFormat='{}{0} Ð¿Ñ€Ð¸Ð¾Ñ€Ð¸Ñ‚ÐµÑ‚'}" 
                                                   FontSize="12" 
                                                   FontWeight="SemiBold"
                                                   Foreground="{Binding PriorityColor}"/>
                                    </StackPanel>
                                </StackPanel>
                            </StackPanel>
                        </Border>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </ScrollViewer>
    </Grid>
</UserControl>