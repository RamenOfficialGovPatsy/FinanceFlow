-- 1. ÐžÑ‡Ð¸ÑÑ‚ÐºÐ° (ÑƒÐ´Ð°Ð»ÑÐµÐ¼ Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ñ‹ Ð² Ð¾Ð±Ñ€Ð°Ñ‚Ð½Ð¾Ð¼ Ð¿Ð¾Ñ€ÑÐ´ÐºÐµ Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚ÐµÐ¹)
DROP TABLE IF EXISTS "AnalyticsReports";
DROP TABLE IF EXISTS "GoalDeposits";
DROP TABLE IF EXISTS "Goals";
DROP TABLE IF EXISTS "GoalCategories";
DROP TABLE IF EXISTS "__EFMigrationsHistory";
-- Ð£Ð´Ð°Ð»ÑÐµÐ¼ Ð¸ÑÑ‚Ð¾Ñ€Ð¸ÑŽ Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸Ð¹ EF, ÐµÑÐ»Ð¸ Ð±Ñ‹Ð»Ð°
-- 2. Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ñ‚Ð°Ð±Ð»Ð¸Ñ†
-- ÐšÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸
CREATE TABLE "GoalCategories" (
    "CategoryId" integer GENERATED BY DEFAULT AS IDENTITY,
    "Name" character varying(50) NOT NULL,
    "Icon" character varying(20) NOT NULL,
    "Color" character varying(7) NOT NULL,
    "SortOrder" integer NOT NULL,
    "IsActive" boolean NOT NULL DEFAULT TRUE,
    "CreatedAt" timestamp without time zone NOT NULL DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT "PK_GoalCategories" PRIMARY KEY ("CategoryId")
);
-- Ð¦ÐµÐ»Ð¸
CREATE TABLE "Goals" (
    "GoalId" integer GENERATED BY DEFAULT AS IDENTITY,
    "CategoryId" integer NOT NULL,
    "Title" character varying(100) NOT NULL,
    "TargetAmount" numeric(15, 2) NOT NULL,
    "CurrentAmount" numeric(15, 2) NOT NULL DEFAULT 0.0,
    "StartDate" timestamp without time zone NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "EndDate" timestamp without time zone NOT NULL,
    "ImagePath" character varying(255),
    "Description" character varying(500),
    "Priority" integer NOT NULL DEFAULT 2,
    "IsCompleted" boolean NOT NULL DEFAULT FALSE,
    "CreatedAt" timestamp without time zone NOT NULL DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT "PK_Goals" PRIMARY KEY ("GoalId"),
    CONSTRAINT "FK_Goals_GoalCategories_CategoryId" FOREIGN KEY ("CategoryId") REFERENCES "GoalCategories" ("CategoryId") ON DELETE CASCADE,
    CONSTRAINT "CK_Goals_TargetAmount" CHECK ("TargetAmount" > 0),
    CONSTRAINT "CK_Goals_CurrentAmount" CHECK ("CurrentAmount" >= 0),
    CONSTRAINT "CK_Goals_Amounts" CHECK ("CurrentAmount" <= "TargetAmount"),
    CONSTRAINT "CK_Goals_Priority" CHECK ("Priority" IN (1, 2, 3))
);
-- ÐŸÐ¾Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ñ
CREATE TABLE "GoalDeposits" (
    "DepositId" integer GENERATED BY DEFAULT AS IDENTITY,
    "GoalId" integer NOT NULL,
    "Amount" numeric(15, 2) NOT NULL,
    "DepositDate" timestamp without time zone NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "Comment" character varying(200),
    "DepositType" character varying(20) NOT NULL DEFAULT 'regular',
    CONSTRAINT "PK_GoalDeposits" PRIMARY KEY ("DepositId"),
    CONSTRAINT "FK_GoalDeposits_Goals_GoalId" FOREIGN KEY ("GoalId") REFERENCES "Goals" ("GoalId") ON DELETE CASCADE,
    CONSTRAINT "CK_GoalDeposits_Amount" CHECK ("Amount" > 0),
    CONSTRAINT "CK_GoalDeposits_Type" CHECK (
        "DepositType" IN (
            'regular',
            'salary',
            'freelance',
            'bonus',
            'other'
        )
    )
);
-- ÐžÑ‚Ñ‡ÐµÑ‚Ñ‹
CREATE TABLE "AnalyticsReports" (
    "ReportId" integer GENERATED BY DEFAULT AS IDENTITY,
    "ReportType" character varying(20) NOT NULL DEFAULT 'monthly',
    "ReportDate" timestamp without time zone NOT NULL,
    "TotalGoals" integer NOT NULL,
    "CompletedGoals" integer NOT NULL,
    "TotalTargetAmount" numeric(15, 2) NOT NULL DEFAULT 0.0,
    "TotalCurrentAmount" numeric(15, 2) NOT NULL DEFAULT 0.0,
    "AverageProgress" numeric(5, 2) NOT NULL DEFAULT 0.0,
    "GeneratedAt" timestamp without time zone NOT NULL DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT "PK_AnalyticsReports" PRIMARY KEY ("ReportId"),
    CONSTRAINT "CK_Reports_Type" CHECK (
        "ReportType" IN ('monthly', 'quarterly', 'yearly', 'custom')
    ),
    CONSTRAINT "CK_Reports_Goals" CHECK ("TotalGoals" >= "CompletedGoals"),
    CONSTRAINT "CK_Reports_Progress" CHECK (
        "AverageProgress" >= 0
        AND "AverageProgress" <= 100
    )
);
- - Ð˜Ð½Ð´ÐµÐºÑÑ‹ (Ð´Ð»Ñ ÑÐºÐ¾Ñ€Ð¾ÑÑ‚Ð¸) CREATE INDEX "IX_Goals_CategoryId" ON "Goals" ("CategoryId");
CREATE INDEX "IX_GoalDeposits_GoalId" ON "GoalDeposits" ("GoalId");
-- 3. ÐÐ°Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ðµ Ð´Ð°Ð½Ð½Ñ‹Ð¼Ð¸ (Seeding)
-- 1. ÐšÐÐ¢Ð•Ð“ÐžÐ Ð˜Ð˜
INSERT INTO "GoalCategories" (
        "CategoryId",
        "Name",
        "Icon",
        "Color",
        "SortOrder",
        "IsActive",
        "CreatedAt"
    ) OVERRIDING SYSTEM VALUE
VALUES (
        1,
        'Ð¢ÐµÑ…Ð½Ð¸ÐºÐ°',
        'ðŸ“±',
        '#311B92',
        1,
        true,
        CURRENT_TIMESTAMP
    ),
    (
        2,
        'Ð¢Ñ€Ð°Ð½ÑÐ¿Ð¾Ñ€Ñ‚',
        'ðŸš—',
        '#880E4F',
        2,
        true,
        CURRENT_TIMESTAMP
    ),
    (
        3,
        'ÐŸÑƒÑ‚ÐµÑˆÐµÑÑ‚Ð²Ð¸Ñ',
        'âœˆï¸',
        '#1A237E',
        3,
        true,
        CURRENT_TIMESTAMP
    ),
    (
        4,
        'ÐÐµÐ´Ð²Ð¸Ð¶Ð¸Ð¼Ð¾ÑÑ‚ÑŒ',
        'ðŸ ',
        '#B45309',
        4,
        true,
        CURRENT_TIMESTAMP
    ),
    (
        5,
        'ÐžÐ±Ñ€Ð°Ð·Ð¾Ð²Ð°Ð½Ð¸Ðµ',
        'ðŸŽ“',
        '#065F46',
        5,
        true,
        CURRENT_TIMESTAMP
    ),
    (
        6,
        'Ð—Ð´Ð¾Ñ€Ð¾Ð²ÑŒÐµ',
        'ðŸ¥',
        '#EC4899',
        6,
        true,
        CURRENT_TIMESTAMP
    ),
    (
        7,
        'Ð Ð°Ð·Ð²Ð»ÐµÑ‡ÐµÐ½Ð¸Ñ',
        'ðŸŽ®',
        '#8B5CF6',
        7,
        true,
        CURRENT_TIMESTAMP
    ),
    (
        8,
        'Ð”Ñ€ÑƒÐ³Ð¾Ðµ',
        'â­',
        '#6B7280',
        8,
        true,
        CURRENT_TIMESTAMP
    );
-- ÐžÐ±Ð½Ð¾Ð²Ð»ÑÐµÐ¼ ÑÑ‡ÐµÑ‚Ñ‡Ð¸Ðº ID Ð´Ð»Ñ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¹
SELECT setval(
        pg_get_serial_sequence('"GoalCategories"', 'CategoryId'),
        8
    );
-- 2. Ð¦Ð•Ð›Ð˜
INSERT INTO "Goals" (
        "GoalId",
        "CategoryId",
        "Title",
        "TargetAmount",
        "CurrentAmount",
        "StartDate",
        "EndDate",
        "Priority",
        "IsCompleted",
        "CreatedAt"
    ) OVERRIDING SYSTEM VALUE
VALUES (
        1,
        1,
        'IPHONE 15 PRO',
        120000,
        45000,
        CURRENT_DATE - INTERVAL '45 days',
        CURRENT_DATE + INTERVAL '45 days',
        2,
        FALSE,
        CURRENT_TIMESTAMP
    ),
    (
        2,
        3,
        'ÐŸÐžÐ•Ð—Ð”ÐšÐ Ð’ Ð¯ÐŸÐžÐÐ˜Ð®',
        200000,
        62000,
        CURRENT_DATE - INTERVAL '120 days',
        CURRENT_DATE + INTERVAL '120 days',
        3,
        FALSE,
        CURRENT_TIMESTAMP
    ),
    (
        3,
        5,
        'ÐœÐÐ“Ð˜Ð¡Ð¢Ð ÐÐ¢Ð£Ð Ð',
        300000,
        90000,
        CURRENT_DATE - INTERVAL '180 days',
        CURRENT_DATE + INTERVAL '180 days',
        1,
        FALSE,
        CURRENT_TIMESTAMP
    ),
    (
        4,
        4,
        'Ð ÐµÐ¼Ð¾Ð½Ñ‚ ÐºÑƒÑ…Ð½Ð¸',
        250000,
        25000,
        CURRENT_DATE - INTERVAL '10 days',
        CURRENT_DATE + INTERVAL '60 days',
        2,
        FALSE,
        CURRENT_TIMESTAMP
    ),
    (
        5,
        2,
        'ÐŸÐµÑ€Ð²Ñ‹Ð¹ Ð²Ð·Ð½Ð¾Ñ',
        500000,
        75000,
        CURRENT_DATE - INTERVAL '200 days',
        CURRENT_DATE + INTERVAL '100 days',
        1,
        FALSE,
        CURRENT_TIMESTAMP
    ),
    (
        6,
        1,
        'Ð˜Ð³Ñ€Ð¾Ð²Ð¾Ð¹ ÐŸÐš',
        150000,
        150000,
        CURRENT_DATE - INTERVAL '90 days',
        CURRENT_DATE - INTERVAL '5 days',
        1,
        TRUE,
        CURRENT_TIMESTAMP
    ),
    (
        7,
        6,
        'Ð›ÐµÑ‡ÐµÐ½Ð¸Ðµ Ð·ÑƒÐ±Ð¾Ð²',
        80000,
        10000,
        CURRENT_DATE - INTERVAL '5 days',
        CURRENT_DATE + INTERVAL '30 days',
        1,
        FALSE,
        CURRENT_TIMESTAMP
    ),
    (
        8,
        8,
        'Ð¤Ð¸Ð½. Ð¿Ð¾Ð´ÑƒÑˆÐºÐ°',
        100000,
        100000,
        CURRENT_DATE - INTERVAL '365 days',
        CURRENT_DATE - INTERVAL '30 days',
        3,
        TRUE,
        CURRENT_TIMESTAMP
    );
-- ÐžÐ±Ð½Ð¾Ð²Ð»ÑÐµÐ¼ ÑÑ‡ÐµÑ‚Ñ‡Ð¸Ðº ID Ð´Ð»Ñ Ñ†ÐµÐ»ÐµÐ¹
SELECT setval(pg_get_serial_sequence('"Goals"', 'GoalId'), 8);
-- 3. Ð˜Ð¡Ð¢ÐžÐ Ð˜Ð¯ ÐŸÐžÐŸÐžÐ›ÐÐ•ÐÐ˜Ð™
INSERT INTO "GoalDeposits" (
        "GoalId",
        "Amount",
        "DepositDate",
        "Comment",
        "DepositType"
    )
VALUES (
        1,
        10000,
        CURRENT_DATE - INTERVAL '40 days',
        'Ð¡Ñ‚Ð°Ñ€Ñ‚',
        'regular'
    ),
    (
        1,
        15000,
        CURRENT_DATE - INTERVAL '20 days',
        'ÐÐ²Ð°Ð½Ñ',
        'salary'
    ),
    (
        1,
        20000,
        CURRENT_DATE - INTERVAL '5 days',
        'ÐŸÐ¾Ð´Ð°Ñ€Ð¾Ðº',
        'other'
    ),
    (
        2,
        30000,
        CURRENT_DATE - INTERVAL '100 days',
        'ÐžÑ‚Ð¿ÑƒÑÐºÐ½Ñ‹Ðµ',
        'bonus'
    ),
    (
        2,
        32000,
        CURRENT_DATE - INTERVAL '10 days',
        'ÐšÐ¾Ð¿Ð¸Ð»ÐºÐ°',
        'regular'
    ),
    (
        3,
        45000,
        CURRENT_DATE - INTERVAL '150 days',
        'Ð¡ÐµÐ¼ÐµÑÑ‚Ñ€ 1',
        'regular'
    ),
    (
        3,
        45000,
        CURRENT_DATE - INTERVAL '10 days',
        'Ð¡ÐµÐ¼ÐµÑÑ‚Ñ€ 2',
        'regular'
    ),
    (
        5,
        75000,
        CURRENT_DATE - INTERVAL '190 days',
        'ÐŸÑ€Ð¾Ð´Ð°Ð¶Ð° ÑÑ‚Ð°Ñ€Ð¾Ð¹ Ñ‚ÐµÑ…Ð½Ð¸ÐºÐ¸',
        'other'
    ),
    (
        6,
        50000,
        CURRENT_DATE - INTERVAL '80 days',
        'ÐÐ°Ñ‡Ð°Ð»Ð¾',
        'regular'
    ),
    (
        6,
        100000,
        CURRENT_DATE - INTERVAL '10 days',
        'ÐŸÑ€ÐµÐ¼Ð¸Ñ Ð³Ð¾Ð´Ð¾Ð²Ð°Ñ',
        'bonus'
    );
-- 4. ÐÐÐÐ›Ð˜Ð¢Ð˜Ð§Ð•Ð¡ÐšÐ˜Ð• ÐžÐ¢Ð§Ð•Ð¢Ð«
INSERT INTO "AnalyticsReports" (
        "ReportType",
        "ReportDate",
        "TotalGoals",
        "CompletedGoals",
        "TotalTargetAmount",
        "TotalCurrentAmount",
        "AverageProgress",
        "GeneratedAt"
    )
VALUES (
        'monthly',
        CURRENT_DATE - INTERVAL '1 month',
        6,
        1,
        1200000,
        350000,
        29.5,
        CURRENT_TIMESTAMP - INTERVAL '1 month'
    ),
    (
        'monthly',
        CURRENT_DATE,
        8,
        2,
        1600000,
        557000,
        34.8,
        CURRENT_TIMESTAMP
    );